local bormusic = {
	"http://198.100.147.20/ttt/music/start/3030.mp3",
	"http://198.100.147.20/ttt/music/start/420.mp3",
	"http://198.100.147.20/ttt/music/start/1983.mp3",
	"http://198.100.147.20/ttt/music/start/around.mp3",
	"http://198.100.147.20/ttt/music/start/b.mp3",
	"http://198.100.147.20/ttt/music/start/battery.mp3",
	"http://198.100.147.20/ttt/music/start/blizzard.mp3",
	"http://198.100.147.20/ttt/music/start/check.mp3",
	"http://198.100.147.20/ttt/music/start/daisuke.mp3",
	"http://198.100.147.20/ttt/music/start/deathracer.mp3",
	"http://198.100.147.20/ttt/music/start/stalking.mp3",
	"http://198.100.147.20/ttt/music/start/fair.mp3",
	"http://198.100.147.20/ttt/music/start/for.mp3",
	"http://198.100.147.20/ttt/music/start/fry.mp3",
	"http://198.100.147.20/ttt/music/start/hand.mp3",
	"http://198.100.147.20/ttt/music/start/hit.mp3",
	"http://198.100.147.20/ttt/music/start/horse.mp3",
	"http://198.100.147.20/ttt/music/start/hydrogen.mp3",
	"http://198.100.147.20/ttt/music/start/inner.mp3",
	"http://198.100.147.20/ttt/music/start/kids.mp3",
	"http://198.100.147.20/ttt/music/start/knock.mp3",
	"http://198.100.147.20/ttt/music/start/LP1.mp3",
	"http://198.100.147.20/ttt/music/start/miami.mp3",
	"http://198.100.147.20/ttt/music/start/purple.mp3",
	"http://198.100.147.20/ttt/music/start/red.mp3",
	"http://198.100.147.20/ttt/music/start/road.mp3",
	"http://198.100.147.20/ttt/music/start/roller.mp3",
	"http://198.100.147.20/ttt/music/start/scenario.mp3",
	"http://198.100.147.20/ttt/music/start/toys.mp3",
	"http://198.100.147.20/ttt/music/start/unkle.mp3",
	"http://198.100.147.20/ttt/music/start/vhs.mp3",
	"http://198.100.147.20/ttt/music/start/visitors.mp3",
	"http://198.100.147.20/ttt/music/start/voodoo.mp3",
	"http://198.100.147.20/ttt/music/start/voyager.mp3",
	"http://198.100.147.20/ttt/music/start/warning.mp3",
	"http://198.100.147.20/ttt/music/start/we.mp3",
	"http://198.100.147.20/ttt/music/start/weare.mp3",
	"http://198.100.147.20/ttt/music/start/with.mp3",
	"http://198.100.147.20/ttt/music/start/old.mp3",
	"http://198.100.147.20/ttt/music/start/jolly.mp3",
	"http://198.100.147.20/ttt/music/start/access.mp3",
	"http://198.100.147.20/ttt/music/start/boymeetgirl.mp3",
	"http://198.100.147.20/ttt/music/start/bunny.mp3",
	"http://198.100.147.20/ttt/music/start/epit.mp3",
	"http://198.100.147.20/ttt/music/start/every.mp3",
	"http://198.100.147.20/ttt/music/start/federal.mp3",
	"http://198.100.147.20/ttt/music/start/loser.mp3",
	"http://198.100.147.20/ttt/music/start/mother.mp3",
	"http://198.100.147.20/ttt/music/start/nuclearl.mp3",
	"http://198.100.147.20/ttt/music/start/redhot.mp3",
	"http://198.100.147.20/ttt/music/start/suns.mp3",
	"http://198.100.147.20/ttt/music/start/topical.mp3",
	"http://198.100.147.20/ttt/music/start/zeta.mp3",
	"http://198.100.147.20/ttt/music/start/backstabber.mp3",
	"http://198.100.147.20/ttt/music/start/bf.mp3",
	"http://198.100.147.20/ttt/music/start/ccr.mp3",
	"http://198.100.147.20/ttt/music/start/clouds.mp3",
	"http://198.100.147.20/ttt/music/start/cream.mp3",
	"http://198.100.147.20/ttt/music/start/dt.mp3",
	"http://198.100.147.20/ttt/music/start/baccano.mp3",
	"http://198.100.147.20/ttt/music/start/duckgametitle.mp3",
	"http://198.100.147.20/ttt/music/start/plantation.mp3",
	"http://198.100.147.20/ttt/music/start/fivefloor.mp3",
	"http://198.100.147.20/ttt/music/start/shuffle.mp3",
	"http://198.100.147.20/ttt/music/start/cereal.mp3",
	"http://198.100.147.20/ttt/music/start/datboi.mp3",
	"http://198.100.147.20/ttt/music/start/led.mp3",
	"http://198.100.147.20/ttt/music/start/life.mp3",
	"http://198.100.147.20/ttt/music/start/rail.mp3",
	"http://198.100.147.20/ttt/music/start/st.mp3",
	"http://198.100.147.20/ttt/music/start/shock.mp3",
	"http://198.100.147.20/ttt/music/start/summerlove.mp3",
	"http://198.100.147.20/ttt/music/start/modestmouth.mp3",
	"http://198.100.147.20/ttt/music/start/madbass.mp3",
	"http://198.100.147.20/ttt/music/start/jeanspirit.mp3",
	"http://198.100.147.20/ttt/music/start/dilbert.mp3",
	"http://198.100.147.20/ttt/music/start/bigshellinc.mp3",
	"http://198.100.147.20/ttt/music/start/wgh.mp3",
	"http://198.100.147.20/ttt/music/start/tnm.mp3",
	"http://198.100.147.20/ttt/music/start/prom.mp3",
	"http://198.100.147.20/ttt/music/start/lod.mp3",
	"http://198.100.147.20/ttt/music/start/olympics.mp3",
	"http://198.100.147.20/ttt/music/start/bird.mp3",
	"http://198.100.147.20/ttt/music/start/zerard.mp3",
	"http://198.100.147.20/ttt/music/start/dre.mp3",
	"http://198.100.147.20/ttt/music/start/dreamer.mp3",
	"http://198.100.147.20/ttt/music/start/fantasy.mp3",
	"http://198.100.147.20/ttt/music/start/lom.mp3",
	"http://198.100.147.20/ttt/music/start/turks.mp3",
	"http://198.100.147.20/ttt/music/start/gt3.mp3",
	"http://198.100.147.20/ttt/music/start/wndrwall.mp3",
	"http://198.100.147.20/ttt/music/start/watch.mp3"
}

WIN_NONE      = 1
WIN_TRAITOR   = 2
WIN_INNOCENT  = 3
WIN_TIMELIMIT = 4
local soundURLS = soundURLS or {}

hook.Add("Initialize", "soclose", function()
	soundURLS[WIN_INNOCENT] = {
		"http://198.100.147.20/ttt/music/innocent/arena.mp3",
		"http://198.100.147.20/ttt/music/innocent/watch.mp3",
		"http://198.100.147.20/ttt/music/innocent/Bristlecone.mp3",
		"http://198.100.147.20/ttt/music/innocent/america.mp3",
		"http://198.100.147.20/ttt/music/innocent/bluesnippon.mp3",
		"http://198.100.147.20/ttt/music/innocent/earlywarning.mp3",
		"http://198.100.147.20/ttt/music/innocent/platinum.mp3",
		"http://198.100.147.20/ttt/music/innocent/seinwave.mp3",
		"http://198.100.147.20/ttt/music/innocent/unassisted.mp3",
		"http://198.100.147.20/ttt/music/innocent/cherry.mp3",
		"http://198.100.147.20/ttt/music/innocent/shotgunshack.mp3",
		"http://198.100.147.20/ttt/music/innocent/complete.mp3",
		"http://198.100.147.20/ttt/music/innocent/dis.mp3",
		"http://198.100.147.20/ttt/music/innocent/dusk.mp3",
		"http://198.100.147.20/ttt/music/innocent/daftmouth.mp3",
		"http://198.100.147.20/ttt/music/innocent/Golden.mp3",
		"http://198.100.147.20/ttt/music/innocent/grand.mp3",
		"http://198.100.147.20/ttt/music/innocent/guitar.mp3",
		"http://198.100.147.20/ttt/music/innocent/bottle.mp3",
		"http://198.100.147.20/ttt/music/innocent/georgiai.mp3",
		"http://198.100.147.20/ttt/music/innocent/prison.mp3",
		"http://198.100.147.20/ttt/music/innocent/walk.mp3",
		"http://198.100.147.20/ttt/music/innocent/blues.mp3",
		"http://198.100.147.20/ttt/music/innocent/body.mp3",
		"http://198.100.147.20/ttt/music/innocent/happiness.mp3",
		"http://198.100.147.20/ttt/music/innocent/Hiphop.mp3",
		"http://198.100.147.20/ttt/music/innocent/Honey.mp3",
		"http://198.100.147.20/ttt/music/innocent/Hyperparadise.mp3",
		"http://198.100.147.20/ttt/music/innocent/Face.mp3",
		"http://198.100.147.20/ttt/music/innocent/Intermission.mp3",
		"http://198.100.147.20/ttt/music/innocent/Jazz.mp3",
		"http://198.100.147.20/ttt/music/innocent/Jimmy.mp3",
		"http://198.100.147.20/ttt/music/innocent/Kamakura.mp3",
		"http://198.100.147.20/ttt/music/innocent/Kiara.mp3",
		"http://198.100.147.20/ttt/music/innocent/King.mp3",
		"http://198.100.147.20/ttt/music/innocent/Lawman.mp3",
		"http://198.100.147.20/ttt/music/innocent/Levee.mp3",
		"http://198.100.147.20/ttt/music/innocent/Let.mp3",
		"http://198.100.147.20/ttt/music/innocent/Maps.mp3",
		"http://198.100.147.20/ttt/music/innocent/Miami.mp3",
		"http://198.100.147.20/ttt/music/innocent/Moon.mp3",
		"http://198.100.147.20/ttt/music/innocent/Organ.mp3",
		"http://198.100.147.20/ttt/music/innocent/Paradise.mp3",
		"http://198.100.147.20/ttt/music/innocent/Peacock.mp3",
		"http://198.100.147.20/ttt/music/innocent/Pepper.mp3",
		"http://198.100.147.20/ttt/music/innocent/Popcorn.mp3",
		"http://198.100.147.20/ttt/music/innocent/Porcelain.mp3",
		"http://198.100.147.20/ttt/music/innocent/Rain.mp3",
		"http://198.100.147.20/ttt/music/innocent/Re.mp3",
		"http://198.100.147.20/ttt/music/innocent/Richard.mp3",
		"http://198.100.147.20/ttt/music/innocent/Rust.mp3",
		"http://198.100.147.20/ttt/music/innocent/Sexualizer.mp3",
		"http://198.100.147.20/ttt/music/innocent/Stay.mp3",
		"http://198.100.147.20/ttt/music/innocent/Supernaut.mp3",
		"http://198.100.147.20/ttt/music/innocent/Take.mp3",
		"http://198.100.147.20/ttt/music/innocent/Creator.mp3",
		"http://198.100.147.20/ttt/music/innocent/Sky.mp3",
		"http://198.100.147.20/ttt/music/innocent/Levee.mp3",
		"http://198.100.147.20/ttt/music/innocent/Know.mp3",
		"http://198.100.147.20/ttt/music/innocent/Roundabout.mp3",
		"http://198.100.147.20/ttt/music/innocent/BIOS.mp3",
		"http://198.100.147.20/ttt/music/innocent/renaimgr.mp3",
		"http://198.100.147.20/ttt/music/innocent/nuclear.mp3",
		"http://198.100.147.20/ttt/music/innocent/smash.mp3",
		"http://198.100.147.20/ttt/music/innocent/sherbert.mp3",
		"http://198.100.147.20/ttt/music/innocent/54.mp3",
		"http://198.100.147.20/ttt/music/innocent/innosnake.mp3",
		"http://198.100.147.20/ttt/music/innocent/kil.mp3",
		"http://198.100.147.20/ttt/music/innocent/cough.mp3",
		"http://198.100.147.20/ttt/music/innocent/yyz.mp3",
		"http://198.100.147.20/ttt/music/innocent/bigiron.mp3",
		"http://198.100.147.20/ttt/music/innocent/eoe.mp3",
		"http://198.100.147.20/ttt/music/innocent/right.mp3",
		"http://198.100.147.20/ttt/music/innocent/worstgirl.mp3",
		"http://198.100.147.20/ttt/music/innocent/body.mp3",
		"http://198.100.147.20/ttt/music/innocent/voodoo.mp3",
		"http://198.100.147.20/ttt/music/innocent/miitomo.mp3",
		"http://198.100.147.20/ttt/music/innocent/save.mp3"
	}

	soundURLS[WIN_TRAITOR] = {
		"http://198.100.147.20/ttt/music/traitor/brook.mp3",
		"http://198.100.147.20/ttt/music/traitor/burncity.mp3",
		"http://198.100.147.20/ttt/music/traitor/ghost.mp3",
		"http://198.100.147.20/ttt/music/traitor/P4.mp3",
		"http://198.100.147.20/ttt/music/traitor/snow.mp3",
		"http://198.100.147.20/ttt/music/traitor/demo.mp3",
		"http://198.100.147.20/ttt/music/traitor/zetaforce.mp3",
		"http://198.100.147.20/ttt/music/traitor/telex.mp3",
		"http://198.100.147.20/ttt/music/traitor/getgot.mp3",
		"http://198.100.147.20/ttt/music/traitor/gross.mp3",
		"http://198.100.147.20/ttt/music/traitor/psychokiller.mp3",
		"http://198.100.147.20/ttt/music/traitor/all.mp3",
		"http://198.100.147.20/ttt/music/traitor/barrel.mp3",
		"http://198.100.147.20/ttt/music/traitor/bolice.mp3",
		"http://198.100.147.20/ttt/music/traitor/dangerzone.mp3",
		"http://198.100.147.20/ttt/music/traitor/boss.mp3",
		"http://198.100.147.20/ttt/music/traitor/business.mp3",
		"http://198.100.147.20/ttt/music/traitor/butter.mp3",
		"http://198.100.147.20/ttt/music/traitor/creditcardneil.mp3",
		"http://198.100.147.20/ttt/music/traitor/celestial.mp3",
		"http://198.100.147.20/ttt/music/traitor/classic.mp3",
		"http://198.100.147.20/ttt/music/traitor/compton.mp3",
		"http://198.100.147.20/ttt/music/traitor/cum.mp3",
		"http://198.100.147.20/ttt/music/traitor/dust.mp3",
		"http://198.100.147.20/ttt/music/traitor/earth.mp3",
		"http://198.100.147.20/ttt/music/traitor/exploder.mp3",
		"http://198.100.147.20/ttt/music/traitor/future.mp3",
		"http://198.100.147.20/ttt/music/traitor/gravity.mp3",
		"http://198.100.147.20/ttt/music/traitor/heartbreaker.mp3",
		"http://198.100.147.20/ttt/music/traitor/helpless.mp3",
		"http://198.100.147.20/ttt/music/traitor/hurt.mp3",
		"http://198.100.147.20/ttt/music/traitor/indispensible.mp3",
		"http://198.100.147.20/ttt/music/traitor/intropy.mp3",
		"http://198.100.147.20/ttt/music/traitor/joe.mp3",
		"http://198.100.147.20/ttt/music/traitor/joke.mp3",
		"http://198.100.147.20/ttt/music/traitor/life.mp3",
		"http://198.100.147.20/ttt/music/traitor/loser.mp3",
		"http://198.100.147.20/ttt/music/traitor/nigga.mp3",
		"http://198.100.147.20/ttt/music/traitor/gun.mp3",
		"http://198.100.147.20/ttt/music/traitor/intermissiont.mp3",
		"http://198.100.147.20/ttt/music/traitor/tyrone.mp3",
		"http://198.100.147.20/ttt/music/traitor/congrats.mp3",
		"http://198.100.147.20/ttt/music/traitor/orchid.mp3",
		"http://198.100.147.20/ttt/music/traitor/paris.mp3",
		"http://198.100.147.20/ttt/music/traitor/phone.mp3",
		"http://198.100.147.20/ttt/music/traitor/planet.mp3",
		"http://198.100.147.20/ttt/music/traitor/poisonous.mp3",
		"http://198.100.147.20/ttt/music/traitor/rokk.mp3",
		"http://198.100.147.20/ttt/music/traitor/safe.mp3",
		"http://198.100.147.20/ttt/music/traitor/safetydance.mp3",
		"http://198.100.147.20/ttt/music/traitor/salmon.mp3",
		"http://198.100.147.20/ttt/music/traitor/sanctuary.mp3",
		"http://198.100.147.20/ttt/music/traitor/distance.mp3",
		"http://198.100.147.20/ttt/music/traitor/knuckles.mp3",
		"http://198.100.147.20/ttt/music/traitor/dying.mp3",
		"http://198.100.147.20/ttt/music/traitor/georgiat.mp3",
		"http://198.100.147.20/ttt/music/traitor/soul.mp3",
		"http://198.100.147.20/ttt/music/traitor/shut.mp3",
		"http://198.100.147.20/ttt/music/traitor/silence.mp3",
		"http://198.100.147.20/ttt/music/traitor/slime.mp3",
		"http://198.100.147.20/ttt/music/traitor/transylvania.mp3",
		"http://198.100.147.20/ttt/music/traitor/tweekers.mp3",
		"http://198.100.147.20/ttt/music/traitor/willie.mp3",
		"http://198.100.147.20/ttt/music/traitor/eoe.mp3",
		"http://198.100.147.20/ttt/music/traitor/wrathchild.mp3",
		"http://198.100.147.20/ttt/music/traitor/vietnam.mp3",
		"http://198.100.147.20/ttt/music/traitor/divide.mp3",
		"http://198.100.147.20/ttt/music/traitor/X.mp3",
		"http://198.100.147.20/ttt/music/traitor/joker.mp3",
		"http://198.100.147.20/ttt/music/traitor/kansas.mp3",
		"http://198.100.147.20/ttt/music/traitor/store.mp3",
		"http://198.100.147.20/ttt/music/traitor/phone.mp3",
		"http://198.100.147.20/ttt/music/traitor/Brook.mp3",
		"http://198.100.147.20/ttt/music/traitor/sogood.mp3",
		"http://198.100.147.20/ttt/music/traitor/sweater.mp3",
		"http://198.100.147.20/ttt/music/traitor/thatslife.mp3"
	}

	soundURLS[WIN_TIMELIMIT] = {
		"http://198.100.147.20/ttt/music/time/smb_gameover.mp3",
		"http://198.100.147.20/ttt/music/time/smb_mariodie.mp3"
	}
end)

if SERVER then
	AddCSLuaFile()
	util.AddNetworkString("Music_Play")

	hook.Add("TTTBeginRound", "PlayStartRoundMusic", function(winType)
		math.randomseed(CurTime())	-- More random!

		local songid = math.random(1, #bormusic)
		local song = bormusic[songid]
		table.remove(bormusic, songid)
		
		net.Start("Music_Play")
			net.WriteString(song)
		net.Broadcast()
	end)

	hook.Add("TTTEndRound", "PlayEndRoundMusic", function(winType)
		math.randomseed(CurTime())	-- More random!
		
		local songid = math.random(1, #soundURLS[winType])
		local song = soundURLS[winType][songid]
		table.remove(soundURLS[winType], songid)
	
		net.Start("Music_Play")
			net.WriteString(song)
		net.Broadcast()
	end)
end

if CLIENT then
	local cvarEnabled = CreateClientConVar( "ttt_music_enabled", "1", true, false )
	local cvarAltTab  = CreateClientConVar( "ttt_music_alttab",  "1", true, false )
	local cvarVolume  = CreateClientConVar( "ttt_music_volume",  ".2", true, false )

	local enabled = enabled or cvarEnabled:GetBool()
	local playUnFocused = playUnFocused or cvarAltTab:GetBool()
	local volume = volume or cvarVolume:GetFloat()
	local soundObject = soundObject or nil

	cvars.AddChangeCallback("ttt_music_enabled", function(name, old, new)
		enabled = tobool(new)
	end)
	cvars.AddChangeCallback("ttt_music_alttab", function(name, old, new)
		playUnFocused = tobool(new)
	end)
	cvars.AddChangeCallback("ttt_music_volume", function(name, old, new)
		volume = tonumber(new)
	end)

	net.Receive("Music_Play", function()
		if not enabled then
			return
		end
		local url = net.ReadString()
		
		if IsValid(soundObject) then
			soundObject:Stop()	--If music is playing end it and start end round music
		end
		
		print(string.sub(url, 33))
		
		sound.PlayURL(url, "", function(retValue)
			soundObject = retValue
			if IsValid(soundObject) then
				if not playUnFocused and not system.HasFocus() then
					soundObject:SetVolume(0)
				else
					soundObject:SetVolume(volume)
				end
				soundObject:Play()
			end
		end)
	end)

	hook.Add("Think", "TTT_EndRoundMusicController", function()
		if not soundObject or not IsValid(soundObject) then return end
		if not enabled then soundObject:Stop() return end
	
		if not playUnFocused and not system.HasFocus() then
			soundObject:SetVolume(0)
			return
		end
		soundObject:SetVolume(volume)
	end)

	hook.Add("TTTSettingsTabs", "Music_Settings", function(dtabs)
		local padding = dtabs:GetPadding() * 2
		local dsettings = vgui.Create("DPanelList", dtabs)
		dsettings:StretchToParent(0,0,padding,0)
		dsettings:EnableVerticalScrollbar(true)
		dsettings:SetPadding(10)
		dsettings:SetSpacing(10)

		local dplay = vgui.Create("DForm", dsettings)
		dplay:SetName("Music Settings")
		dplay:Button("Stop Currently Playing Music").DoClick = function() if IsValid(soundObject) then soundObject:Stop() end end
		dplay:CheckBox("Enabled", "ttt_music_enabled"):SetValue(enabled)
		dplay:CheckBox("Play When Alt+Tabbed", "ttt_music_alttab"):SetValue(playUnFocused)
		dplay:NumSlider("Volume", "ttt_music_volume", 0, 1, 2):SetValue(volume)

		dsettings:AddItem(dplay)		
		dtabs:AddSheet("Custom Settings", dsettings, "icon16/wrench_orange.png", false, false, "General settings")
	end)
	
	hook.Add("OnPlayerChat", "Music_ChatCommand", function(ply, text)
		if (ply == LocalPlayer() and string.sub(text, 1, 5) == "!stop") then
			if IsValid(soundObject) then
				soundObject:Stop()
			end
			return true
		end
	end)
end